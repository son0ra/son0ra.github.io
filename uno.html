<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uno Glass Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

        :root {
            --bg: #0f172a;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-thick: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --accent: #22d3ee;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: white;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border);
        }

        .glass-card {
            background: var(--glass-thick);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .uno-card {
            width: 110px;
            height: 160px;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            position: relative;
            user-select: none;
            flex-shrink: 0;
        }

        .uno-card:hover {
            transform: translateY(-40px) scale(1.1);
            z-index: 100 !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Color Themes */
        .card-red { background: linear-gradient(135deg, #f43f5e, #be123c); }
        .card-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .card-green { background: linear-gradient(135deg, #10b981, #047857); }
        .card-yellow { background: linear-gradient(135deg, #eab308, #a16207); }
        .card-wild { background: linear-gradient(135deg, #334155, #0f172a); border: 1px solid rgba(255,255,255,0.2); }

        .hand-scroll {
            display: flex;
            gap: 12px;
            padding: 40px 60px;
            overflow-x: auto;
            scrollbar-width: none;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        .hand-scroll::-webkit-scrollbar { display: none; }

        .active-glow {
            border: 2px solid var(--accent) !important;
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
            background: rgba(34, 211, 238, 0.05) !important;
        }

        .btn-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }
        .btn-glass:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        /* Layout Sections */
        .arena-zone { height: 15%; }
        .table-zone { height: 55%; }
        .vault-zone { height: 30%; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .floating { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body>

    <!-- Game UI -->
    <div id="game-ui" class="h-full flex flex-col opacity-0 transition-opacity duration-1000">
        
        <!-- Arena: Opponents -->
        <div class="arena-zone flex items-center justify-center gap-4 px-6 border-b border-white/5">
            <div id="opponents-list" class="flex gap-4"></div>
        </div>

        <!-- Table: The Play Area -->
        <div class="table-zone flex flex-col items-center justify-center relative bg-white/[0.01]">
            <div id="status-display" class="absolute top-6 glass px-6 py-2 rounded-full text-xs font-bold tracking-widest text-cyan-400 uppercase">
                Ready
            </div>

            <div class="flex items-center gap-16 md:gap-32">
                <!-- Draw Pile -->
                <div onclick="game.drawCard()" class="uno-card glass-card group hover:border-cyan-400 transition-colors">
                    <div class="bg-white/10 p-4 rounded-full mb-2 group-hover:scale-110 transition-transform">
                        <i data-lucide="layers" class="w-8 h-8 text-white/40 group-hover:text-cyan-400"></i>
                    </div>
                    <div class="text-[10px] font-black uppercase tracking-widest text-white/30 group-hover:text-white">Draw Pile</div>
                </div>

                <!-- Discard Pile -->
                <div id="discard-area" class="relative floating">
                    <!-- Top card -->
                </div>
            </div>

            <!-- Direction & Color Meta -->
            <div class="absolute bottom-8 flex flex-col items-center gap-3">
                <div id="direction-icon" class="transition-transform duration-700">
                    <i data-lucide="rotate-cw" class="w-6 h-6 text-white/20"></i>
                </div>
                <div id="color-stripe" class="h-1 w-24 rounded-full bg-white/10 transition-all duration-500 shadow-[0_0_15px_rgba(255,255,255,0.1)]"></div>
            </div>
        </div>

        <!-- Vault: Player's Hand -->
        <div class="vault-zone glass flex flex-col border-t border-white/10 relative">
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 glass px-4 py-1 rounded-full text-[10px] font-black text-white/40 uppercase tracking-tighter">
                Your Vault
            </div>
            <div id="hand-container" class="hand-scroll"></div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="config-modal" class="fixed inset-0 z-[200] flex items-center justify-center p-6 bg-[#0f172a]">
        <div class="max-w-md w-full glass-card p-10 text-center border-white/10">
            <div class="w-20 h-20 bg-cyan-500/20 rounded-3xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="sparkles" class="w-10 h-10 text-cyan-400"></i>
            </div>
            <h1 class="text-4xl font-black mb-2 tracking-tighter">UNO</h1>
            <p class="text-slate-400 text-sm mb-10">Glass Edition v2.0</p>
            
            <div class="space-y-6">
                <div class="text-left">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block">Username</label>
                    <input id="user-name" type="text" placeholder="Gamer_1" class="w-full glass bg-white/5 border-white/10 rounded-xl p-4 focus:outline-none focus:border-cyan-400 transition-colors text-center font-bold">
                </div>
                <div class="text-left">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block">CPU Rivals: <span id="cpu-val" class="text-cyan-400">3</span></label>
                    <input id="cpu-range" type="range" min="1" max="5" value="3" oninput="document.getElementById('cpu-val').innerText = this.value" class="w-full h-1.5 bg-white/10 rounded-full appearance-none cursor-pointer accent-cyan-400">
                </div>
                <button onclick="ui.launch()" class="w-full py-5 rounded-2xl bg-white text-slate-900 font-black text-lg hover:bg-cyan-400 transition-colors shadow-2xl">Enter Arena</button>
            </div>
        </div>
    </div>

    <!-- Color Selection Modal -->
    <div id="color-overlay" class="fixed inset-0 bg-slate-950/90 z-[300] flex items-center justify-center hidden backdrop-blur-xl">
        <div class="text-center">
            <h3 class="text-xs font-black mb-12 tracking-[0.4em] text-slate-500">SELECT NEW ELEMENT</h3>
            <div class="grid grid-cols-2 gap-8">
                <div onclick="game.confirmColor('red')" class="w-24 h-24 rounded-3xl card-red cursor-pointer hover:scale-110 transition-transform shadow-2xl"></div>
                <div onclick="game.confirmColor('blue')" class="w-24 h-24 rounded-3xl card-blue cursor-pointer hover:scale-110 transition-transform shadow-2xl"></div>
                <div onclick="game.confirmColor('green')" class="w-24 h-24 rounded-3xl card-green cursor-pointer hover:scale-110 transition-transform shadow-2xl"></div>
                <div onclick="game.confirmColor('yellow')" class="w-24 h-24 rounded-3xl card-yellow cursor-pointer hover:scale-110 transition-transform shadow-2xl"></div>
            </div>
        </div>
    </div>

    <script>
        const COLORS = ['red', 'blue', 'green', 'yellow'];
        const VALUES = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'SKIP', 'REV', '+2'];

        class AudioSystem {
            constructor() { this.synth = new Tone.PolySynth(Tone.Synth).toDestination(); }
            play(note = "C4") { this.synth.triggerAttackRelease(note, "32n"); }
            playWin() {
                const now = Tone.now();
                this.synth.triggerAttackRelease("C4", "8n", now);
                this.synth.triggerAttackRelease("E4", "8n", now + 0.1);
                this.synth.triggerAttackRelease("G4", "4n", now + 0.2);
            }
        }

        const audio = new AudioSystem();

        class UnoGame {
            constructor() {
                this.deck = [];
                this.discard = [];
                this.players = [];
                this.turn = 0;
                this.dir = 1;
                this.activeColor = '';
                this.isRunning = false;
            }

            getTemplate(value) {
                switch(value) {
                    case 'SKIP': return '<i data-lucide="circle-slash-2" class="w-10 h-10 opacity-80"></i>';
                    case 'REV': return '<i data-lucide="refresh-cw" class="w-10 h-10 opacity-80"></i>';
                    case '+2': return '<div class="text-4xl font-black">+2</div>';
                    case 'WILD': return '<i data-lucide="sparkle" class="w-10 h-10 opacity-80"></i>';
                    case 'WILD+4': return '<div class="flex flex-col items-center"><i data-lucide="sparkles" class="w-8 h-8 mb-1"></i><div class="text-2xl font-black">+4</div></div>';
                    default: return `<span class="text-5xl font-black">${value}</span>`;
                }
            }

            start(cpus, name) {
                this.deck = [];
                COLORS.forEach(c => {
                    VALUES.forEach(v => {
                        this.deck.push({ color: c, value: v });
                        if (v !== '0') this.deck.push({ color: c, value: v });
                    });
                });
                for(let i=0; i<4; i++) {
                    this.deck.push({ color: 'wild', value: 'WILD' });
                    this.deck.push({ color: 'wild', value: 'WILD+4' });
                }
                this.deck.sort(() => Math.random() - 0.5);

                this.players = [{ id: 0, name: name || "You", hand: [], isAI: false }];
                for(let i=1; i<=cpus; i++) {
                    this.players.push({ id: i, name: `CPU ${i}`, hand: [], isAI: true });
                }

                this.players.forEach(p => {
                    for(let i=0; i<7; i++) p.hand.push(this.deck.pop());
                });

                const first = this.deck.pop();
                this.discard.push(first);
                this.activeColor = first.color === 'wild' ? 'red' : first.color;
                
                this.isRunning = true;
                ui.update();
            }

            play(pIdx, cIdx) {
                if (pIdx !== this.turn || !this.isRunning) return;
                const p = this.players[pIdx];
                const card = p.hand[cIdx];
                const top = this.discard[this.discard.length-1];

                if (card.color === 'wild' || card.color === this.activeColor || card.value === top.value) {
                    p.hand.splice(cIdx, 1);
                    this.discard.push(card);
                    this.activeColor = card.color;
                    audio.play("E4");

                    if (card.color === 'wild') {
                        if (p.isAI) {
                            const colors = p.hand.map(c => c.color).filter(c => c !== 'wild');
                            this.confirmColor(colors.length ? colors[0] : 'red');
                        } else {
                            document.getElementById('color-overlay').classList.remove('hidden');
                            return;
                        }
                    }

                    this.effects(card);
                    if (p.hand.length === 0) {
                        this.isRunning = false;
                        audio.playWin();
                        confetti({ particleCount: 200, spread: 90 });
                        setTimeout(() => { alert(`${p.name} Wins!`); location.reload(); }, 100);
                        return;
                    }
                    this.next();
                }
            }

            effects(card) {
                if (card.value === 'REV') this.dir *= -1;
                if (card.value === 'SKIP') this.next();
                if (card.value === '+2') {
                    this.next();
                    this.take(this.players[this.turn], 2);
                }
                if (card.value === 'WILD+4') {
                    const victim = (this.turn + this.dir + this.players.length) % this.players.length;
                    this.take(this.players[victim], 4);
                }
            }

            take(player, n) {
                for(let i=0; i<n; i++) {
                    if (this.deck.length === 0) {
                        const top = this.discard.pop();
                        this.deck = [...this.discard].sort(() => Math.random() - 0.5);
                        this.discard = [top];
                    }
                    player.hand.push(this.deck.pop());
                }
            }

            drawCard() {
                if (this.turn !== 0) return;
                this.take(this.players[0], 1);
                audio.play("G3");
                this.next();
            }

            next() {
                this.turn = (this.turn + this.dir + this.players.length) % this.players.length;
                ui.update();
                if (this.players[this.turn].isAI) setTimeout(() => this.cpuAction(), 1500);
            }

            cpuAction() {
                if (!this.isRunning) return;
                const p = this.players[this.turn];
                const top = this.discard[this.discard.length-1];
                let idx = p.hand.findIndex(c => c.color === 'wild' || c.color === this.activeColor || c.value === top.value);
                if (idx !== -1) this.play(this.turn, idx);
                else { this.take(p, 1); this.next(); }
            }

            confirmColor(c) {
                this.activeColor = c;
                document.getElementById('color-overlay').classList.add('hidden');
                this.next();
            }
        }

        const game = new UnoGame();

        const ui = {
            launch() {
                document.getElementById('config-modal').classList.add('hidden');
                document.getElementById('game-ui').classList.remove('opacity-0');
                Tone.start();
                game.start(
                    parseInt(document.getElementById('cpu-range').value),
                    document.getElementById('user-name').value
                );
            },
            update() {
                const hand = document.getElementById('hand-container');
                const opps = document.getElementById('opponents-list');
                const disc = document.getElementById('discard-area');
                const stripe = document.getElementById('color-stripe');
                const dir = document.getElementById('direction-icon');

                hand.innerHTML = '';
                game.players[0].hand.forEach((c, i) => {
                    const card = document.createElement('div');
                    card.className = `uno-card card-${c.color} shadow-xl`;
                    card.innerHTML = game.getTemplate(c.value);
                    card.onclick = () => game.play(0, i);
                    hand.appendChild(card);
                });

                opps.innerHTML = '';
                game.players.slice(1).forEach(p => {
                    const el = document.createElement('div');
                    el.className = `glass-card px-6 py-2 transition-all duration-500 ${game.turn === p.id ? 'active-glow scale-110' : 'opacity-40'}`;
                    el.innerHTML = `<div class="text-[8px] font-black tracking-widest text-white/30 uppercase">${p.name}</div><div class="text-lg font-black">${p.hand.length}</div>`;
                    opps.appendChild(el);
                });

                const top = game.discard[game.discard.length-1];
                disc.innerHTML = `<div class="uno-card card-${top.color} scale-125 border-white shadow-2xl">${game.getTemplate(top.value)}</div>`;

                stripe.style.backgroundColor = game.activeColor;
                stripe.style.boxShadow = `0 0 20px ${game.activeColor}`;
                dir.style.transform = game.dir === 1 ? 'rotate(0deg)' : 'rotate(180deg) scaleX(-1)';

                document.getElementById('status-display').innerText = 
                    game.turn === 0 ? "Your Action" : `${game.players[game.turn].name}'s Move`;
                
                lucide.createIcons();
            }
        };

        window.game = game;
        window.ui = ui;
    </script>
</body>
</html>
